<!DOCTYPE html>
<html lang="id" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pijat Ibu Yanti - Luxurious Wellness</title>

    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        sage: {
                            light: '#ccd5ae',
                            DEFAULT: '#9caf88',
                            dark: '#7a8c69',
                        },
                        lux: {
                            gray: '#f7f9f7',
                            dark: '#2d3748',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom smooth popup animation */
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.3s ease-out;
        }

        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
        }
    </style>
</head>

<body class="bg-lux-gray text-lux-dark antialiased">

    <!-- Navbar -->
    <nav class="fixed w-full bg-white/90 backdrop-blur-md shadow-sm z-40 transition-all duration-300">
        <div class="max-w-md mx-auto px-4 py-4 flex justify-between items-center md:max-w-4xl">
            <div class="text-xl font-bold text-sage-dark drop-shadow-sm flex items-center gap-2">
                <i class="fa-solid fa-leaf text-sage"></i>
                Pijat Ibu Yanti
            </div>
            <a href="#services" class="text-sm font-medium text-sage-dark hover:text-sage transition">Layanan</a>
        </div>
    </nav>

    <!-- App Container (Mobile First approach) -->
    <main class="max-w-md mx-auto bg-white min-h-screen shadow-2xl md:max-w-4xl relative overflow-hidden">

        <!-- Hero Section -->
        <section id="hero"
            class="relative pt-28 pb-16 px-6 text-center bg-cover bg-center bg-no-repeat flex flex-col items-center justify-center min-h-[60vh] md:min-h-[70vh]"
            style="background-image: url('https://images.unsplash.com/photo-1544161515-4ab6ce6db874?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80');">

            <!-- Dark Overlay for Readability -->
            <div class="absolute inset-0 bg-black/70 backdrop-blur-[1px]"></div>

            <!-- Content Area -->
            <div class="relative z-10 w-full flex flex-col items-center">
                <div class="bg-white/90 backdrop-blur-sm p-4 rounded-full shadow-lg mb-6 text-sage-dark inline-block">
                    <i class="fa-solid fa-spa text-3xl"></i>
                </div>

                <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 leading-tight drop-shadow-md">
                    Pijat Ibu <span class="text-sage-light">Yanti</span>
                </h1>

                <!-- Trust Badges (Emphasized) -->
                <div class="flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4 mb-8">
                    <div
                        class="bg-rose-500/90 backdrop-blur-sm text-white px-4 py-1.5 rounded-full text-xs font-semibold shadow-lg border border-rose-400/50 flex items-center gap-2 min-w-max">
                        <i class="fa-solid fa-venus"></i> Khusus Wanita & Keluarga
                    </div>
                    <div
                        class="bg-sage/90 backdrop-blur-sm text-white px-4 py-1.5 rounded-full text-xs font-semibold shadow-lg border border-sage-light/50 flex items-center gap-2 min-w-max">
                        <i class="fa-solid fa-certificate"></i> Profesional & Bersertifikat
                    </div>
                </div>

                <!-- Fading Text Carousel for Marketing Copy -->
                <div class="w-full max-w-sm md:max-w-md mx-auto mb-10 h-24 sm:h-20 relative">
                    <div id="text-carousel-1"
                        class="absolute inset-0 transition-opacity duration-1000 opacity-100 flex items-center justify-center text-center">
                        <p class="text-white text-sm md:text-base font-medium drop-shadow-md leading-relaxed">
                            Berhentilah mengabaikan rasa lelah dan pegal yang menguras kebahagiaan Anda setiap harinya.
                        </p>
                    </div>
                    <div id="text-carousel-2"
                        class="absolute inset-0 transition-opacity duration-1000 opacity-0 flex items-center justify-center text-center">
                        <p class="text-white text-sm md:text-base font-medium drop-shadow-md leading-relaxed">
                            Tubuh Anda adalah aset terbaik. Berikan sentuhan pemulihan terdalam yang meresap ke
                            sanubari.
                        </p>
                    </div>
                    <div id="text-carousel-3"
                        class="absolute inset-0 transition-opacity duration-1000 opacity-0 flex items-center justify-center text-center">
                        <p
                            class="text-white text-sm md:text-base font-medium drop-shadow-md leading-relaxed text-sage-light">
                            Pesan sekarang! Rasakan magisnya kelegaan emosional & fisik di tangan terapis andal kami.
                        </p>
                    </div>
                </div>

                <a href="#services"
                    class="bg-sage hover:bg-sage-dark text-white font-bold py-3.5 px-8 rounded-full shadow-[0_0_20px_rgba(156,175,136,0.5)] border border-sage-light/50 transition-all transform hover:-translate-y-1 hover:scale-105 w-full max-w-xs md:max-w-sm mx-auto active:scale-95 text-lg">
                    <i class="fa-solid fa-calendar-check mr-2"></i> Panggil Terapis
                </a>
            </div>
        </section>

        <!-- Testimonial Section -->
        <section id="testimonials" class="py-12 px-6 bg-white">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-lux-dark mb-2">Terpercaya & Profesional</h2>
                <div class="w-16 h-1 bg-sage mx-auto rounded-full"></div>
            </div>

            <div class="space-y-4 md:flex md:space-y-0 md:space-x-4 md:overflow-x-auto pb-4">
                <!-- Testi 1 -->
                <div class="bg-lux-gray p-5 rounded-2xl border border-gray-100 shadow-sm md:min-w-[300px]">
                    <div class="flex text-yellow-500 text-sm mb-3">
                        <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                            class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                            class="fa-solid fa-star"></i>
                    </div>
                    <p class="text-gray-600 text-sm italic mb-4">"Terapisnya ramah banget, pijatannya pas dan bikin
                        badan saya enteng lagi. Recommended buat ibu-ibu yang capek ngurus rumah."</p>
                    <div class="flex items-center gap-3">
                        <div
                            class="w-8 h-8 rounded-full bg-sage-light text-sage-dark flex items-center justify-center font-bold text-xs">
                            AS</div>
                        <span class="font-semibold text-sm">Aisyah S.</span>
                    </div>
                </div>
                <!-- Testi 2 -->
                <div class="bg-lux-gray p-5 rounded-2xl border border-gray-100 shadow-sm md:min-w-[300px]">
                    <div class="flex text-yellow-500 text-sm mb-3">
                        <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                            class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                            class="fa-solid fa-star"></i>
                    </div>
                    <p class="text-gray-600 text-sm italic mb-4">"Pesan via web ini praktis. Terapis datang tepat waktu,
                        sopan, dan pijat lulurnya benar-benar merelaksasi setelah kerja seharian."</p>
                    <div class="flex items-center gap-3">
                        <div
                            class="w-8 h-8 rounded-full bg-sage-light text-sage-dark flex items-center justify-center font-bold text-xs">
                            NL</div>
                        <span class="font-semibold text-sm">Nadia L.</span>
                    </div>
                </div>
                <!-- Testi 3 -->
                <div class="bg-lux-gray p-5 rounded-2xl border border-gray-100 shadow-sm md:min-w-[300px]">
                    <div class="flex text-yellow-500 text-sm mb-3">
                        <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                            class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                            class="fa-solid fa-star"></i>
                    </div>
                    <p class="text-gray-600 text-sm italic mb-4">"Totok wajahnya enak banget, pusing saya langsung
                        hilang. Bakal jadi langganan setiap minggu nih pokoknya."</p>
                    <div class="flex items-center gap-3">
                        <div
                            class="w-8 h-8 rounded-full bg-sage-light text-sage-dark flex items-center justify-center font-bold text-xs">
                            RM</div>
                        <span class="font-semibold text-sm">Rina M.</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Service Section -->
        <section id="services" class="py-12 px-6 bg-sage-light/10">
            <div class="text-center mb-10">
                <h2 class="text-2xl font-bold text-lux-dark mb-2">Pilihan Layanan</h2>
                <div class="w-16 h-1 bg-sage mx-auto rounded-full"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="service-list">
                <!-- Javascript will inject services here -->
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-lux-dark text-white py-10 px-6 text-center">
            <i class="fa-solid fa-leaf text-sage mb-4 text-3xl"></i>
            <h3 class="font-bold text-lg mb-2">Pijat Ibu Yanti</h3>
            <p class="text-gray-400 text-sm mb-6 max-w-xs mx-auto">
                Layanan kebugaran & relaksasi profesional langsung ke pintu Anda.
            </p>
            <div class="bg-white/10 p-3 rounded-lg inline-block border border-white/20 mb-6">
                <i class="fa-solid fa-venus text-sage-light mr-2"></i>
                <span class="text-sm font-medium">Layanan khusus untuk Wanita & Keluarga</span>
            </div>
            <p class="text-xs text-gray-500 mt-4">&copy; 2026 xxcrdhoo. All rights reserved.</p>
        </footer>

    </main>

    <!-- MODAL PEMESANAN -->
    <div id="booking-modal" class="fixed inset-0 z-50 flex items-end md:items-center justify-center hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal()"></div>

        <!-- Modal Content -->
        <div id="modal-content"
            class="bg-white w-full max-w-md md:max-w-lg md:rounded-2xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative z-10 modal-enter pb-6 md:pb-0 shadow-2xl">

            <!-- Header Modal -->
            <div
                class="sticky top-0 bg-white border-b border-gray-100 p-5 flex justify-between items-center z-20 rounded-t-3xl md:rounded-t-2xl">
                <div>
                    <h3 class="font-bold text-lg text-lux-dark">Selesaikan Pesanan</h3>
                    <p class="text-xs text-sage-dark font-medium" id="modal-queue-id">Antrean: PJT-XXXX</p>
                </div>
                <button onclick="closeModal()"
                    class="w-8 h-8 bg-gray-100 rounded-full text-gray-600 hover:bg-rose-50 hover:text-rose-500 flex items-center justify-center transition">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="p-6 space-y-6">
                <!-- Selected Service Info -->
                <div class="bg-sage-light/20 p-4 rounded-xl border border-sage/20 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-16 h-16 bg-sage/10 rounded-bl-full -z-10"></div>
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-lux-dark" id="modal-service-name">Layanan</h4>
                        <span class="font-bold text-sage-dark" id="modal-base-price">Rp 0</span>
                    </div>
                </div>

                <form id="booking-form" class="space-y-4">

                    <!-- Step 1: Durasi -->
                    <div id="duration-section">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Langkah 1: Pilih Durasi Tambahan
                            (Opsional)</label>
                        <div class="grid grid-cols-3 gap-2">
                            <label class="cursor-pointer">
                                <input type="radio" name="duration" value="Bawaan" class="peer hidden" checked
                                    onchange="calculateTotal()">
                                <div
                                    class="text-center py-2 px-1 rounded-xl border-2 border-gray-100 peer-checked:border-sage peer-checked:bg-sage/10 hover:border-sage-light transition text-xs font-semibold text-gray-500 peer-checked:text-sage-dark shadow-sm">
                                    Sesuai Paket<br><span class="text-[10px] font-normal">Normal</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="duration" value="+ 30 Menit" class="peer hidden"
                                    onchange="calculateTotal()">
                                <div
                                    class="text-center py-2 px-1 rounded-xl border-2 border-gray-100 peer-checked:border-sage peer-checked:bg-sage/10 hover:border-sage-light transition text-xs font-semibold text-gray-500 peer-checked:text-sage-dark shadow-sm">
                                    + 30 Menit<br><span class="text-[10px] font-normal">+ Rp 49.000</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="duration" value="+ 60 Menit" class="peer hidden"
                                    onchange="calculateTotal()">
                                <div
                                    class="text-center py-2 px-1 rounded-xl border-2 border-gray-100 peer-checked:border-sage peer-checked:bg-sage/10 hover:border-sage-light transition text-xs font-semibold text-gray-500 peer-checked:text-sage-dark shadow-sm">
                                    + 60 Menit<br><span class="text-[10px] font-normal">+ Rp 89.000</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <hr class="border-gray-50">

                    <!-- Step 2: Form Data Diri -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Langkah 2: Informasi
                            Kedatangan</label>
                        <div class="space-y-3">
                            <div>
                                <input type="text" id="cust-name" required placeholder="Nama Lengkap"
                                    class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-sage focus:ring-1 focus:ring-sage focus:bg-white transition shadow-inner">
                            </div>

                            <div class="grid grid-cols-1 gap-3">
                                <div>
                                    <label class="block text-xs font-semibold text-gray-500 mb-1">Pilih Tanggal</label>
                                    <input type="date" id="cust-date" required onchange="renderTimeSlots()"
                                        class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-sage focus:ring-1 focus:ring-sage focus:bg-white transition text-gray-600 shadow-inner">
                                </div>

                                <div>
                                    <label class="block text-xs font-semibold text-gray-500 mb-1">Pilih Jam</label>

                                    <!-- Hidden Input to store the selected time -->
                                    <input type="hidden" id="cust-time" required>

                                    <!-- Time Slots Grid -->
                                    <div class="grid grid-cols-4 gap-2" id="time-slots-container">
                                        <!-- Javascript will inject time slots here -->
                                    </div>
                                    <p class="text-[10px] text-gray-400 mt-2 italic">*Jam abu-abu sudah dibooking
                                        (penuh) untuk tanggal ini.</p>
                                </div>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <button type="button" onclick="getLocation()" id="btn-location"
                                        class="w-full bg-sage-light/30 hover:bg-sage-light text-sage-dark font-medium py-2.5 px-3 rounded-xl text-xs transition flex items-center justify-center gap-2 border border-sage/20 shadow-sm">
                                        <i class="fa-solid fa-location-crosshairs"></i> Gunakan Lokasi Saat Ini (Google
                                        Maps)
                                    </button>
                                </div>
                                <textarea id="cust-address" required rows="3"
                                    placeholder="Alamat Lengkap / Link Shareloc (Maps)"
                                    class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-sage focus:ring-1 focus:ring-sage focus:bg-white transition resize-none shadow-inner"></textarea>
                                <p id="location-status" class="text-[10px] text-gray-500 mt-1 hidden"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Total Price Info -->
                    <div
                        class="bg-gradient-to-r from-gray-50 to-white p-4 rounded-xl flex justify-between items-center border border-gray-100 mt-4 shadow-sm">
                        <span class="text-sm font-semibold text-gray-600">Total Pembayaran:</span>
                        <span class="text-xl font-bold text-lux-dark drop-shadow-sm" id="modal-total-price">Rp 0</span>
                    </div>

                    <div
                        class="text-[11px] text-center text-gray-500 mt-2 bg-yellow-50 text-yellow-700 py-1.5 px-3 rounded-lg border border-yellow-100">
                        <i class="fa-solid fa-circle-info mr-1"></i> Pembayaran dilakukan langsung setelah sesi pijat
                        selesai.
                    </div>

                    <!-- Submit Button -->
                    <button type="button" onclick="submitToWhatsApp()"
                        class="w-full bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold py-3.5 px-4 rounded-xl shadow-[0_5px_15px_rgba(37,211,102,0.4)] transition-all transform active:scale-95 flex justify-center items-center gap-2 mt-4 text-sm md:text-base">
                        <i class="fa-brands fa-whatsapp text-xl"></i> Konfirmasi & Kirim WA
                    </button>

                </form>
            </div>
        </div>
    </div>

    <!-- CUSTOM ALERT MODAL -->
    <div id="alert-modal" class="fixed inset-0 z-[60] flex items-center justify-center hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeAlertModal()"></div>

        <!-- Modal Content -->
        <div id="alert-content"
            class="bg-white w-full max-w-sm rounded-2xl p-6 relative z-10 mx-4 shadow-2xl modal-enter text-center border overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-amber-400"></div>

            <div
                class="w-16 h-16 bg-amber-100 text-amber-500 rounded-full flex items-center justify-center text-3xl mx-auto mb-4 mt-2">
                <i class="fa-solid fa-clock-rotate-left"></i>
            </div>

            <h3 class="text-lg font-bold text-lux-dark mb-2 font-sans" id="alert-title">Sabar Dulu, Kak!</h3>
            <p class="text-gray-600 text-sm mb-4 leading-relaxed" id="alert-message">
                Anda sudah melakukan pemesanan sebelumnya. Mohon tunggu respon Admin kami. Pemesanan ulang dapat
                dilakukan 1 jam setelah pemesanan terakhir.
            </p>

            <!-- Countdown Timer Container (Hidden by default) -->
            <div id="countdown-container"
                class="hidden bg-gray-50 border border-gray-100 rounded-xl p-3 mb-6 shadow-inner">
                <p class="text-xs text-gray-500 font-medium mb-1 uppercase tracking-widest">Waktu Tunggu:</p>
                <div
                    class="flex items-center justify-center gap-2 text-2xl font-bold font-mono text-sage-dark drop-shadow-sm">
                    <span id="cd-minutes">00</span>
                    <span class="text-rose-400 -mt-1 animate-pulse">:</span>
                    <span id="cd-seconds">00</span>
                </div>
            </div>

            <button onclick="closeAlertModal()"
                class="w-full bg-lux-dark hover:bg-gray-800 text-white font-semibold py-3 rounded-xl transition shadow-md">
                Mengerti
            </button>
        </div>
    </div>


    <!-- GANTI NOMOR WHATSAPP -->
    <script>


        const ADMIN_WA_NUMBER = "6282326864835";

        // Data Layanan berserta Harga Psikologis (S3 Marketing)
        // 200rb -> 199.000, 250rb -> 249.000, 150rb -> 149.000, 170rb -> 169.000
        const servicesData = [
            { id: 1, name: "Pijat Full Body", ext: "(2 Jam)", price: 199000, icon: "fa-hands" },
            { id: 2, name: "Pijat Lulur", ext: "(2 Jam)", price: 249000, icon: "fa-leaf" },
            { id: 3, name: "Totok Wajah", ext: "(1.5 Jam)", price: 199000, icon: "fa-face-smile" },
            { id: 4, name: "Susah Tidur (Insomnia)", ext: "(1.5 Jam)", price: 149000, icon: "fa-bed" },
            { id: 5, name: "Tangan/Kaki Susah Gerak", ext: "(2 Jam)", price: 249000, icon: "fa-person-walking" },
            { id: 6, name: "Pijat Keseleo / Otot Tegang", ext: "(1.5 Jam)", price: 199000, icon: "fa-kit-medical" },
            { id: 7, name: "Pijat Anak / Ibu Hamil", ext: "(1.5 Jam)", price: 169000, icon: "fa-baby" },
            { id: 8, name: "Paket Stroke (Mingguan)", ext: "(Sesuai Perawatan)", price: 0, isChatAdmin: true, icon: "fa-heart-pulse" }
        ];

        // Format Rupiah
        const formatRupiah = (number) => {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
        };

        // Render Service List ke HTML
        const renderServices = () => {
            const container = document.getElementById('service-list');
            container.innerHTML = servicesData.map(service => `
                <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-16 h-16 bg-sage-light/20 rounded-bl-full -z-10 group-hover:scale-110 transition-transform"></div>
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-xl bg-sage-light/30 text-sage-dark flex items-center justify-center text-xl flex-shrink-0">
                            <i class="fa-solid ${service.icon}"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-lux-dark text-sm leading-tight">${service.name} <span class="text-xs text-gray-400 font-normal">${service.ext}</span></h3>
                            <p class="text-sage-dark font-bold mt-1 text-sm bg-sage-light/20 inline-block px-2 py-0.5 rounded">
                                ${service.isChatAdmin ? "Hubungi Admin" : formatRupiah(service.price)}
                            </p>
                        </div>
                    </div>
                    <button onclick="openModal(${service.id})" class="mt-4 w-full bg-lux-gray hover:bg-sage text-sage-dark hover:text-white border border-sage/20 text-sm font-semibold py-2 rounded-xl transition-colors">
                        Pilih Layanan
                    </button>
                </div>
            `).join('');
        };

        // State Modal
        let currentService = null;
        let queueID = "";

        // Data Jam Operasional (08:00 - 20:00)
        const operationalHours = [
            "08:00", "09:00", "10:00", "11:00", "12:00", "13:00",
            "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00"
        ];

        // Mendapatkan Daftar Jam Sibuk dari LocalStorage berdasarkan tanggal
        const getBookedSlots = (date) => {
            const bookedData = localStorage.getItem('bookedSlots_' + date);
            return bookedData ? JSON.parse(bookedData) : [];
        };

        // Menyimpan Jadwal Booking ke LocalStorage
        const saveBookedSlot = (date, time) => {
            const bookedSlots = getBookedSlots(date);
            if (!bookedSlots.includes(time)) {
                bookedSlots.push(time);
                localStorage.setItem('bookedSlots_' + date, JSON.stringify(bookedSlots));
            }
        };

        // Render Sistem Jam (Memblokir yang sudah penuh)
        const renderTimeSlots = () => {
            const container = document.getElementById('time-slots-container');
            const selectedDate = document.getElementById('cust-date').value;
            const timeInputHidden = document.getElementById('cust-time');

            // Reset pilihan jam jika tanggal diganti
            timeInputHidden.value = "";

            if (!selectedDate) {
                container.innerHTML = `<div class="col-span-4 text-xs text-gray-400 text-center py-2">Silakan pilih tanggal terlebih dahulu</div>`;
                return;
            }

            const bookedSlots = getBookedSlots(selectedDate);

            container.innerHTML = operationalHours.map(time => {
                const isBooked = bookedSlots.includes(time);

                if (isBooked) {
                    return `
                    <div class="text-center py-2 px-1 rounded-lg border border-gray-200 bg-gray-100 text-gray-400 text-xs font-medium cursor-not-allowed opacity-60">
                        ${time} <i class="fa-solid fa-lock text-[8px] ml-1"></i>
                    </div>`;
                } else {
                    return `
                    <label class="cursor-pointer">
                        <input type="radio" name="time_slot" value="${time}" class="peer hidden" onchange="document.getElementById('cust-time').value = this.value">
                        <div class="text-center py-2 px-1 rounded-lg border border-gray-200 bg-white hover:bg-sage/10 hover:border-sage-light peer-checked:bg-sage peer-checked:text-white peer-checked:border-sage peer-checked:shadow-md transition-all text-xs font-semibold text-gray-600">
                            ${time}
                        </div>
                    </label>`;
                }
            }).join('');
        };

        // Fungsi Cek Cooldown (1 Jam) berdasarkan Nama ATAU Alamat
        // Mengembalikan { status: boolean, remainingMs: number (sisa waktu ms jika true) }
        const checkCooldown = (name, address) => {
            // Bersihkan format nama dan alamat (lowercase, hapus spasi berlebih) buat cek
            const cleanName = name ? name.toLowerCase().trim() : "";
            const cleanAddr = address ? address.toLowerCase().replace(/[\n\r]+/g, ' ').trim() : "";

            const lastOrderNameData = cleanName ? localStorage.getItem('lastOrder_name_' + cleanName) : null;
            const lastOrderAddrData = cleanAddr ? localStorage.getItem('lastOrder_addr_' + cleanAddr) : null;

            let mostRecentTime = 0;

            if (lastOrderNameData) {
                mostRecentTime = Math.max(mostRecentTime, parseInt(lastOrderNameData));
            }
            if (lastOrderAddrData) {
                mostRecentTime = Math.max(mostRecentTime, parseInt(lastOrderAddrData));
            }

            if (mostRecentTime > 0) {
                const currentTime = new Date().getTime();
                const diffMs = currentTime - mostRecentTime;
                const cooldownMs = 1000 * 60 * 60; // 1 Jam

                if (diffMs < cooldownMs) {
                    return { status: true, remainingMs: cooldownMs - diffMs }; // Masih cooldown
                }
            }
            return { status: false, remainingMs: 0 }; // Bisa pesan
        };

        // Custom JS Modal Functions
        let activeCountdownInterval = null; // Menyimpan ID interval agar bisa dibersihkan

        const showCustomAlert = (title, message, remainingMs = null) => {
            document.getElementById('alert-title').innerText = title;
            document.getElementById('alert-message').innerText = message;

            const countdownContainer = document.getElementById('countdown-container');
            const minElem = document.getElementById('cd-minutes');
            const secElem = document.getElementById('cd-seconds');

            // Bersihkan interval yang lama jika ada
            if (activeCountdownInterval) {
                clearInterval(activeCountdownInterval);
                activeCountdownInterval = null;
            }

            // Jika ada sisa waktu mundur, tampilkan dan jalankan timer
            if (remainingMs != null && remainingMs > 0) {
                countdownContainer.classList.remove('hidden');

                let timeRemaining = Math.floor(remainingMs / 1000); // dalam detik

                const updateDisplay = () => {
                    const m = Math.floor(timeRemaining / 60);
                    const s = timeRemaining % 60;

                    minElem.innerText = m.toString().padStart(2, '0');
                    secElem.innerText = s.toString().padStart(2, '0');

                    if (timeRemaining <= 0) {
                        clearInterval(activeCountdownInterval);
                        countdownContainer.classList.add('hidden');
                        document.getElementById('alert-title').innerText = "Waktu Tunggu Selesai!";
                        document.getElementById('alert-message').innerText = "Silakan coba pesan kembali sekarang.";
                    }
                    timeRemaining--;
                };

                // Jalankan pertama kali, lalu setiap detik
                updateDisplay();
                activeCountdownInterval = setInterval(updateDisplay, 1000);

            } else {
                // Sembunyikan timer untuk peringatan biasa
                countdownContainer.classList.add('hidden');
            }

            const modal = document.getElementById('alert-modal');
            const content = document.getElementById('alert-content');

            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.add('modal-enter-active');
            }, 10);
            document.body.style.overflow = 'hidden';
        };

        const closeAlertModal = () => {
            // Matikan interval saat menutup modal agar tidak bocor memori
            if (activeCountdownInterval) {
                clearInterval(activeCountdownInterval);
                activeCountdownInterval = null;
            }

            const modal = document.getElementById('alert-modal');
            const content = document.getElementById('alert-content');

            content.classList.remove('modal-enter-active');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);

            // Re-enable body scrolling ONLY if booking modal is not open
            if (document.getElementById('booking-modal').classList.contains('hidden')) {
                document.body.style.overflow = 'auto';
            }
        };

        // Buka Modal
        const openModal = (serviceId) => {
            currentService = servicesData.find(s => s.id === serviceId);

            // Generate Queue ID
            const randomNums = Math.floor(1000 + Math.random() * 9000);
            queueID = `PJT-${randomNums}`;

            document.getElementById('modal-queue-id').innerText = `Antrean: ${queueID}`;
            document.getElementById('modal-service-name').innerText = currentService.name;

            // Tampilkan harga modal awal (Base Price)
            if (currentService.isChatAdmin) {
                document.getElementById('modal-base-price').innerText = "Konsultasi Admin";
                document.getElementById('duration-section').style.display = 'none';
            } else {
                document.getElementById('modal-base-price').innerText = formatRupiah(currentService.price);
                document.getElementById('duration-section').style.display = 'block';
            }

            // Reset Form & Default ke "Sesuai Paket"
            document.getElementById('booking-form').reset();
            document.querySelector('input[name="duration"][value="Bawaan"]').checked = true;

            // Update Total
            calculateTotal();

            // Set default tanggal hari ini & Render Jam
            const dateInput = document.getElementById('cust-date');

            // Format tanggal hari ini jadi YYYY-MM-DD agar masuk ke input type date
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            dateInput.value = `${yyyy}-${mm}-${dd}`;

            // Batasi agar tidak bisa milih tanggal mundur
            dateInput.min = `${yyyy}-${mm}-${dd}`;

            document.getElementById('cust-time').value = ""; // Reset hidden time val
            renderTimeSlots();

            // Animasi & Tampilkan Modal
            const modal = document.getElementById('booking-modal');
            const content = document.getElementById('modal-content');

            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.add('modal-enter-active');
            }, 10);

            // Prevent body scroll (biar keren di HP)
            document.body.style.overflow = 'hidden';
        };

        // Tutup Modal
        const closeModal = () => {
            const modal = document.getElementById('booking-modal');
            const content = document.getElementById('modal-content');

            content.classList.remove('modal-enter-active');
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto'; // Kembali bisa scroll body
            }, 300);
        };

        // Hitung Total (Base Price + Tambahan Durasi)
        const calculateTotal = () => {
            if (!currentService) return;

            const durationInputs = document.getElementsByName('duration');
            let selectedDuration = "Bawaan";
            let additionalCost = 0;

            for (let radio of durationInputs) {
                if (radio.checked) {
                    selectedDuration = radio.value;
                    break;
                }
            }

            // Menerapkan S3 Marketing: Harga psikologis diskon untuk extra time
            if (selectedDuration === "+ 30 Menit") additionalCost = 49000;
            if (selectedDuration === "+ 60 Menit") additionalCost = 89000;

            const totalPriceId = document.getElementById('modal-total-price');

            if (currentService.isChatAdmin) {
                totalPriceId.innerText = "Harga Diskusi";
            } else {
                totalPriceId.innerText = formatRupiah(currentService.price + additionalCost);
            }
        };

        // Eksekusi Ke WhatsApp
        const submitToWhatsApp = () => {
            const name = document.getElementById('cust-name').value;
            const date = document.getElementById('cust-date').value;
            const time = document.getElementById('cust-time').value;
            const address = document.getElementById('cust-address').value;

            // Validasi Input
            if (!name || !date || !time || !address) {
                if (!time) {
                    showCustomAlert("Pilih Jam Dulu", "Mohon pilih salah satu Jam Kedatangan (yang tidak terkunci berwarna abu-abu) sebelum mengkonfirmasi pesanan Anda.");
                } else {
                    showCustomAlert("Form Belum Lengkap", "Mohon lengkapi semua data diri, pilih tanggal, pilih jam, dan isi alamat/shareloc Anda.");
                }
                return;
            }

            // Cari Durasi & Total
            const durationInputs = document.getElementsByName('duration');
            let selectedExtendDuration = "Bawaan";
            for (let radio of durationInputs) {
                if (radio.checked) { selectedExtendDuration = radio.value; break; }
            }

            let totalText = "";
            let durationText = "";

            if (currentService.isChatAdmin) {
                totalText = "Menunggu info admin";
                durationText = "Paket Khusus (Mingguan)";
            } else {
                let cost = currentService.price;
                if (selectedExtendDuration === "+ 30 Menit") cost += 49000;
                if (selectedExtendDuration === "+ 60 Menit") cost += 89000;
                totalText = formatRupiah(cost);

                // Format gabungan durasi bawaan layanan + durasi tambahan (jika ada)
                if (selectedExtendDuration === "Bawaan") {
                    durationText = currentService.ext;
                } else {
                    durationText = `${currentService.ext} ditambah ${selectedExtendDuration}`;
                }
            }

            // Format Pesan WA
            const textWa = `Halo *Pijat Ibu Yanti*, saya ingin melakukan pemesanan layanan pijat. Berikut detailnya:

*ðŸ“ Data Pemesan*
â€¢ *Antrean:* ${queueID}
â€¢ *Nama:* ${name}

*ðŸ’†â€â™€ï¸ Layanan yang Dipilih*
â€¢ *Jenis Layanan:* ${currentService.name}
â€¢ *Durasi:* ${durationText}

*ðŸ“… Jadwal & Lokasi*
â€¢ *Tanggal:* ${date}
â€¢ *Waktu:* ${time} WIB
â€¢ *Alamat:* ${address}

*ðŸ’° Total Pembayaran:* ${totalText}

_Pemberitahuan: Pembayaran dapat dilakukan secara tunai/transfer SETELAH sesi pijat selesai._`;

            // Cek apakah user sedang dalam masa cooldown 1 jam dari NAMA atau ALAMAT yang sama
            const cooldownData = checkCooldown(name, address);

            if (cooldownData.status) {
                showCustomAlert(
                    "Antrean Masih Dibuka âœ‹",
                    `Sistem mendeteksi pesanan terkait dari Akun/Alamat Anda dalam 1 jam terakhir. Mohon menunggu balasan Admin atau tunggu hingga waktu di bawah ini habis.`,
                    cooldownData.remainingMs
                );
                return;
            }

            // MENCATAT BOOKING SLOT JAM & WAKTU KE LOCALSTORAGE
            saveBookedSlot(date, time); // Use 'time' not 'selectedTime'

            const timestampNow = new Date().getTime().toString();
            // Simpan jejak Nama & Alamat
            if (name) localStorage.setItem('lastOrder_name_' + name.toLowerCase().trim(), timestampNow);
            if (address) localStorage.setItem('lastOrder_addr_' + address.toLowerCase().replace(/[\n\r]+/g, ' ').trim(), timestampNow);

            // Render ulang jam jika user menutup langsung setelah kirim WA
            renderTimeSlots();

            // Buka Link WA
            const urlWa = `https://wa.me/${ADMIN_WA_NUMBER}?text=${encodeURIComponent(textWa)}`;
            window.open(urlWa, '_blank');
            closeModal();
        };

        // Dapatkan Lokasi Pengguna
        const getLocation = () => {
            const statusText = document.getElementById('location-status');
            const addressInput = document.getElementById('cust-address');
            const btnLocation = document.getElementById('btn-location');

            if (!navigator.geolocation) {
                statusText.innerText = "Geolokasi tidak didukung oleh browser Anda.";
                statusText.classList.remove('hidden');
                statusText.classList.add('text-red-500');
                return;
            }

            statusText.innerText = "Mendeteksi lokasi Anda...";
            statusText.classList.remove('hidden', 'text-red-500', 'text-green-500');
            statusText.classList.add('text-gray-500');
            btnLocation.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Mendeteksi...`;
            btnLocation.disabled = true;

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;

                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
                        const data = await response.json();

                        if (data && data.display_name) {
                            addressInput.value = data.display_name + `\n\n(Link Maps: https://maps.google.com/?q=${lat},${lng})`;
                            statusText.innerText = "Lokasi berhasil dideteksi.";
                            statusText.classList.replace('text-gray-500', 'text-green-500');
                        } else {
                            addressInput.value = `https://maps.google.com/?q=${lat},${lng}`;
                            statusText.innerText = "Hanya kordinat yang didapat, URL peta digunakan.";
                            statusText.classList.replace('text-gray-500', 'text-yellow-500');
                        }
                    } catch (error) {
                        addressInput.value = `https://maps.google.com/?q=${lat},${lng}`;
                        statusText.innerText = "Gagal memuat alamat. URL peta digunakan.";
                        statusText.classList.replace('text-gray-500', 'text-yellow-500');
                    }

                    btnLocation.innerHTML = `<i class="fa-solid fa-location-dot"></i> Lokasi Ditemukan`;
                    btnLocation.classList.replace('bg-sage-light/30', 'bg-sage');
                    btnLocation.classList.replace('text-sage-dark', 'text-white');
                    btnLocation.disabled = false;
                },
                (error) => {
                    statusText.innerText = "Akses lokasi ditolak atau gagal. Mohon izinkan akses.";
                    statusText.classList.replace('text-gray-500', 'text-red-500');
                    btnLocation.innerHTML = `<i class="fa-solid fa-location-crosshairs"></i> Coba Lagi`;
                    btnLocation.disabled = false;
                },
                { enableHighAccuracy: true }
            );
        };

        // Animasi Fading Teks Hero
        const startTextCarousel = () => {
            let currentSlide = 1;
            const totalSlides = 3;

            setInterval(() => {
                // Hide current
                document.getElementById(`text-carousel-${currentSlide}`).classList.remove('opacity-100');
                document.getElementById(`text-carousel-${currentSlide}`).classList.add('opacity-0');

                // Move to next
                currentSlide = currentSlide >= totalSlides ? 1 : currentSlide + 1;

                // Show next
                setTimeout(() => {
                    document.getElementById(`text-carousel-${currentSlide}`).classList.remove('opacity-0');
                    document.getElementById(`text-carousel-${currentSlide}`).classList.add('opacity-100');
                }, 500); // Wait half second before fading in

            }, 4000); // Change text every 4 seconds
        };

        // Initialize Services on Load
        window.addEventListener('DOMContentLoaded', () => {
            renderServices();
            startTextCarousel(); // Start animations

            // ANTI INSPECT & DEV TOOLS DISABLER
            document.addEventListener('contextmenu', event => event.preventDefault());

            document.onkeydown = function (e) {
                // Disable F12
                if (e.key === "F12") {
                    return false;
                }
                // Disable Ctrl+Shift+I (Chrome) / Ctrl+Shift+J (Console) / Ctrl+U (Source)
                if (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "i" || e.key === "J" || e.key === "j" || e.key === "C" || e.key === "c")) {
                    return false;
                }
                if (e.ctrlKey && (e.key === "U" || e.key === "u")) {
                    return false;
                }
            };
        });

    </script>
</body>

</html>
